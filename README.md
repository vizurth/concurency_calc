# Распределённый вычислитель арифметических выражений

## Описание проекта
Этот проект представляет собой распределённую систему для вычисления арифметических выражений. Основная идея заключается в том, что операции сложения, вычитания, умножения и деления выполняются "очень долго" и требуют значительных вычислительных ресурсов.

В связи с этим система реализована в виде двух ключевых компонентов:
- **Оркестратор** — сервер, принимающий выражения, разбивающий их на задачи и распределяющий выполнение.
- **Агент** — вычислитель, который получает задачи, выполняет их и возвращает результаты.

## Архитектура
### Оркестратор
Оркестратор предоставляет REST API и управляет выполнением выражений. Он:
- принимает выражения от пользователей,
- разбивает их на отдельные операции,
- распределяет задачи между агентами,
- отслеживает статус выполнения.

### Агент
Агент выполняет вычислительные задачи. Он:
- запрашивает задачи у оркестратора,
- выполняет вычисления,
- отправляет результат обратно оркестратору.

## Установка и запуск
Для запуска системы используйте следующую команду:
```sh
make run
```
или, если используется Go напрямую:
```sh
go run ./cmd/calc_service/...
```

Также проект можно запустить с помощью Docker:
```sh
docker-compose up --build
```

### Переменные окружения
Перед запуском задайте значения для переменных окружения:
```sh
export TIME_ADDITION_MS=1000
export TIME_SUBTRACTION_MS=1000
export TIME_MULTIPLICATIONS_MS=2000
export TIME_DIVISIONS_MS=2000
export COMPUTING_POWER=5
```

## API эндпоинты
### 1. Добавление вычисления выражения
```sh
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*2"
}'
```
**Ответ:**
```json
{
    "id": "<уникальный идентификатор>"
}
```

### 2. Получение списка выражений
```sh
curl --location 'localhost/api/v1/expressions'
```
**Ответ:**
```json
{
    "expressions": [
        {
            "id": "1",
            "status": "pending",
            "result": null
        },
        {
            "id": "2",
            "status": "done",
            "result": 6
        }
    ]
}
```

### 3. Получение выражения по идентификатору
```sh
curl --location 'localhost/api/v1/expressions/:id'
```
**Ответ:**
```json
{
    "expression": {
        "id": "1",
        "status": "pending",
        "result": null
    }
}
```

### 4. Получение задачи для выполнения (агент)
```sh
curl --location 'localhost/internal/task'
```
**Ответ:**
```json
{
    "task": {
        "id": 1,
        "arg1": "2",
        "arg2": "2",
        "operation": "*",
        "operation_time": 2000
    }
}
```

### 5. Отправка результата вычисления
```sh
curl --location 'localhost/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": 1,
  "result": 4
}'
```
**Ответ:**
```json
{
    "status": "success"
}
```

## Тестирование
Проект покрыт тестами. Запуск тестов:
```sh
make test
```
или
```sh
go test ./...
```

## Веб-интерфейс
При наличии энтузиазма можно реализовать фронтенд для взаимодействия с API.

## Лицензия
Этот проект распространяется под лицензией MIT.

